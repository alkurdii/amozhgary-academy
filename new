<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Black Bear Coffee - POS</title>
    
    <!-- Icons & Fonts (Internet needed for first load only, works from cache later) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Unikurd+Web&family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* BLACK BEAR THEME */
            --brand: #171717;        /* Jet Black */
            --brand-hover: #404040;
            --dark: #000000;         /* Pure Black */
            --bg: #f3f4f6;          /* Light Gray Background */
            --card: #ffffff;
            --text: #1f2937;
            --danger: #dc2626;
            --success: #059669;
            --warning: #d97706;
            --sidebar-w: 260px;
        }

        * { box-sizing: border-box; font-family: 'Unikurd Web', 'Segoe UI', Tahoma, sans-serif; user-select: none; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }

        /* --- UI ELEMENTS --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95);
            z-index: 9999; display: flex; justify-content: center; align-items: center; color: white;
            backdrop-filter: blur(10px);
        }
        .glass-card {
            background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(20px);
            padding: 40px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
            width: 450px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.8);
        }
        .pin-input {
            width: 100%; padding: 15px; text-align: center; font-size: 1.5rem; letter-spacing: 10px;
            border-radius: 12px; border: none; outline: none; margin-bottom: 20px;
            background: white; color: black;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-w); background: var(--dark); color: #9ca3af;
            display: flex; flex-direction: column; transition: 0.3s;
        }
        .sidebar-header { 
            padding: 30px; text-align: center; color: white; font-size: 1.5rem; 
            font-weight: bold; border-bottom: 1px solid #374151; letter-spacing: 1px;
        }
        .nav-item {
            padding: 15px 25px; cursor: pointer; display: flex; align-items: center; gap: 15px;
            transition: 0.2s; border-right: 4px solid transparent;
        }
        .nav-item:hover, .nav-item.active { background: #262626; color: white; border-right-color: white; }

        /* --- CONTENT --- */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .top-bar {
            height: 60px; background: var(--card); display: flex; align-items: center;
            justify-content: space-between; padding: 0 30px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 10;
        }
        .workspace { flex: 1; padding: 20px; overflow-y: auto; display: none; background: var(--bg); }
        .workspace.active { display: block; animation: fadeIn 0.3s ease; }

        /* --- COMPONENTS --- */
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border-right: 5px solid var(--brand); }
        .stat-card h3 { margin: 0; font-size: 0.9rem; opacity: 0.7; }
        .stat-card h1 { margin: 10px 0 0; font-size: 1.8rem; }

        .btn {
            padding: 12px 20px; border: none; border-radius: 12px; cursor: pointer;
            font-weight: bold; transition: 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-brand { background: var(--brand); color: white; }
        .btn-brand:hover { background: var(--brand-hover); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-dark { background: var(--dark); color: white; }

        .card { background: var(--card); border-radius: 18px; padding: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .input-std { width: 100%; padding: 12px; border: 1.5px solid #e2e8f0; border-radius: 10px; margin-bottom: 10px; outline: none; transition: 0.2s; user-select: auto;}
        
        /* --- POS UI --- */
        .pos-layout { display: flex; gap: 20px; height: calc(100vh - 110px); }
        .pos-menu { flex: 7; display: flex; flex-direction: column; overflow: hidden; }
        .pos-bill { flex: 3; background: var(--card); border-radius: 20px; display: flex; flex-direction: column; box-shadow: -5px 0 15px rgba(0,0,0,0.05); overflow: hidden; }
        
        /* Categories Bar */
        .category-bar {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px;
            white-space: nowrap; -webkit-overflow-scrolling: touch;
        }
        .category-bar::-webkit-scrollbar { height: 5px; }
        .category-bar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .cat-btn {
            padding: 12px 25px; border-radius: 50px; border: 1px solid #e2e8f0; background: white;
            cursor: pointer; font-weight: bold; color: var(--text); transition: 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .cat-btn.active, .cat-btn:hover { background: var(--brand); color: white; border-color: var(--brand); transform: translateY(-2px); }

        /* Product Grid */
        .product-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
            gap: 15px; overflow-y: auto; padding: 5px; flex: 1;
        }
        .p-card {
            background: white; border-radius: 16px; padding: 20px 10px; text-align: center;
            cursor: pointer; transition: 0.2s; border: 2px solid transparent; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); height: 140px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .p-card:hover { border-color: var(--brand); transform: translateY(-3px); }
        .p-card:active { transform: scale(0.98); }
        .p-card b { display: block; margin-bottom: 8px; font-size: 1.1rem; }
        .p-card p { margin: 0; color: var(--brand); font-weight: bold; background: #f3f4f6; padding: 4px 10px; border-radius: 20px; font-size: 0.9rem; }
        
        .qty-badge {
            position: absolute; top: 10px; left: 10px; background: var(--dark); color: white;
            padding: 2px 8px; border-radius: 8px; font-size: 0.8rem;
        }

        /* Bill Styles */
        .bill-header { padding: 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; text-align: center; }
        .bill-logo-img { max-width: 80px; max-height: 80px; margin-bottom: 5px; display: none; }
        .bill-items { flex: 1; overflow-y: auto; padding: 15px; }
        .bill-row { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; margin-bottom: 8px; background: #f8fafc; border-radius: 12px;
            border-right: 3px solid transparent; transition: 0.2s;
        }
        .bill-row:hover { border-right-color: var(--danger); background: #fff1f2; }
        .bill-footer { padding: 20px; background: white; border-top: 1px solid #e2e8f0; }

        .delete-btn {
            width: 25px; height: 25px; border-radius: 50%; background: #fee2e2; color: var(--danger);
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s;
        }
        .delete-btn:hover { background: var(--danger); color: white; }

        /* Report Table */
        .report-table { width: 100%; border-collapse: collapse; }
        .report-table th, .report-table td { padding: 12px; border-bottom: 1px solid #e2e8f0; text-align: right; }
        .report-table th { background: #f8fafc; }

        /* --- PRINT STYLES (80mm Thermal) --- */
        @media print {
            @page { margin: 0; size: 80mm auto; }
            body { margin: 0; padding: 0; background: white; color: black; width: 80mm; font-family: monospace; }
            .sidebar, .top-bar, .pos-menu, .btn, .no-print, .workspace > *:not(.pos-layout), .startup-screen, .modal-overlay { display: none !important; }
            
            #view-pos, .pos-layout, .pos-bill { 
                display: block !important; height: auto !important; width: 100% !important; 
                position: static !important; box-shadow: none !important; border: none !important; margin: 0 !important;
            }
            .bill-items { overflow: visible !important; height: auto !important; }
            .bill-footer { background: white !important; }
            .bill-row { background: none !important; border: none !important; padding: 5px 0 !important; border-bottom: 1px dashed black !important; border-radius: 0 !important; }
            .delete-btn { display: none !important; }
            
            .bill-header { padding-bottom: 5px; border-bottom: 2px solid black; }
            .bill-logo-img[src=""] { display: none !important; }
            .bill-logo-img:not([src=""]) { display: block !important; margin: 0 auto 10px auto; }

            /* Kitchen Mode */
            body.kitchen-mode .price-col, 
            body.kitchen-mode .bill-total-section,
            body.kitchen-mode .bill-footer h2,
            body.kitchen-mode .bill-footer span,
            body.kitchen-mode .bill-logo-img,
            body.kitchen-mode #print-custom-header { display: none !important; }
            
            body.kitchen-mode .bill-header::before {
                content: 'ğŸ§‘â€ğŸ³ KITCHEN / BARISTA â˜•';
                font-size: 1.5rem; border-bottom: 2px dashed black; padding-bottom:5px; display:block;
            }
            body.kitchen-mode .bill-row span:last-child { display: none; } 
            body.kitchen-mode .bill-row { font-weight: bold; font-size: 1.3rem; margin-bottom: 5px; }
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- STARTUP SCREEN -->
    <div id="startup-screen" class="modal-overlay">
        <div class="glass-card">
            <!-- BLACK BEAR IMAGE -->
            <div style="background: white; width: 120px; height: 120px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto; overflow: hidden; border: 4px solid white;">
                <i class="fas fa-bear" style="font-size: 4rem; color: black;"></i>
            </div>
            
            <h1 style="margin-bottom: 5px;">Black Bear Coffee</h1>
            <p style="opacity: 0.8; margin-bottom: 30px;">Premium POS System 2025</p>
            
            <button class="btn btn-brand" style="width:100%; padding:18px; margin-bottom:15px; background:white; color:black" onclick="initDB('new')">
                <i class="fas fa-plus-circle"></i> Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ù†Ø§ Ø³ÛŒØ³ØªÛ•Ù…Û•Ú©Û Ù†ÙˆÛŒ
            </button>
            <button class="btn btn-success" style="width:100%; padding:18px;" onclick="initDB('load')">
                <i class="fas fa-folder-open"></i> Ø¨Ø§Ø±Ú©Ø±Ù†Ø§ Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³Û (JSON)
            </button>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="modal-overlay" style="display:none;">
        <div class="glass-card" style="background: rgba(0, 0, 0, 0.9);">
             <!-- Small Bear Logo -->
            <i class="fas fa-paw" style="font-size: 3rem; color: white; margin-bottom: 20px;"></i>
            <h2>Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±</h2>
            <p style="color:#6b7280; font-size:0.9rem;">Admin: 0000 | Cashier: 1234</p>
            <input type="password" id="pin-code" class="pin-input" placeholder="PIN" maxlength="4">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn btn-brand" style="background:white; color:black" onclick="attemptLogin()">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±</button>
                <button class="btn btn-danger" onclick="location.reload()">Ø¯Û•Ø±Ú©Û•ÙØªÙ†</button>
            </div>
            <p id="login-error" style="color:var(--danger); margin-top:10px;"></p>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-bear"></i> Black Bear
        </div>
        <nav style="flex:1">
            <div class="nav-item active" onclick="nav('dash')"><i class="fas fa-chart-line"></i> Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯</div>
            <div class="nav-item" onclick="nav('tables')"><i class="fas fa-couch"></i> Ù…ÛØ²Û•Ú©Ø§Ù†</div>
            <div class="nav-item" id="nav-pos" onclick="nav('pos')" style="display:none"><i class="fas fa-coffee"></i> ÙØ±Û†Ø´ØªÙ† (POS)</div>
            <div class="nav-item protected" onclick="nav('products')"><i class="fas fa-box"></i> Ø¦Ø§ÛŒØªÙ… & Ù†Ø±Ø®</div>
            <div class="nav-item protected" onclick="nav('expenses')"><i class="fas fa-wallet"></i> Ø®Û•Ø±Ø¬ÛŒ</div>
            <div class="nav-item protected" onclick="nav('reports')"><i class="fas fa-file-invoice-dollar"></i> Ú•Ø§Ù¾Û†Ø±Øª</div>
        </nav>
        <div class="nav-item protected" onclick="nav('settings')" style="border-top:1px solid #374151"><i class="fas fa-cog"></i> Ø±ÛÚ©Ø®Ø³ØªÙ†</div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <div class="top-bar">
            <div style="color: #64748b; font-size:0.9rem; display:flex; align-items:center; gap:5px;">
                <i class="fas fa-circle" style="color:var(--success); font-size:10px;"></i> 
                <span>Offline Mode</span>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <span id="user-display">Ú©Ø§Ø±Ù…Û•Ù†Ø¯</span>
                <i class="fas fa-user-circle" style="font-size:1.5rem; cursor:pointer;" onclick="location.reload()"></i>
            </div>
        </div>

        <!-- DASHBOARD -->
        <div id="view-dash" class="workspace active">
            <div class="stat-grid">
                <div class="stat-card"><h3>ÙØ±Û†Ø´ØªÙ†Ø§ Ø¦Û•Ú¤Ú•Û† (Cash)</h3><h1 id="st-sales">0</h1></div>
                <div class="stat-card" style="border-right-color:var(--danger)"><h3>Ø®Û•Ø±Ø¬ÛŒ</h3><h1 id="st-exp">0</h1></div>
                <div class="stat-card" style="border-right-color:var(--success)"><h3>Ù‚Ø§Ø³Û• (Net Cash)</h3><h1 id="st-profit">0</h1></div>
                <div class="stat-card" style="border-right-color:var(--warning)"><h3>Ú˜Ù…Ø§Ø±Ø§ Ù¾Ø³ÙˆÙˆÙ„Ø§Ù†</h3><h1 id="st-count">0</h1></div>
            </div>
            <div class="card">
                <h3><i class="fas fa-history"></i> Ù…ÛØ²ÛÙ† Ú†Ø§Ù„Ø§Ú©</h3>
                <div id="dash-tables" class="product-grid" style="margin-top:20px; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));"></div>
            </div>
        </div>

        <!-- TABLES -->
        <div id="view-tables" class="workspace">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>Ù†Û•Ø®Ø´Û•ÛŒ Ù…ÛØ²Û•Ú©Ø§Ù†</h2>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-warning protected" onclick="transferTableUI()">ğŸ”„ Ú¯Û†Ø§Ø³ØªÙ†Û•ÙˆÛ•</button>
                    <button class="btn btn-dark protected" onclick="printZReport()">ğŸ“  Ø¯Ø§Ø®Ø³ØªÙ†Ø§ Ú•Û†Ú˜Û (Z)</button>
                    <button class="btn btn-brand protected" onclick="addTable()">+ Ù…ÛØ²</button>
                </div>
            </div>
            <div id="tables-grid" class="product-grid" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));"></div>
        </div>

        <!-- POS SYSTEM -->
        <div id="view-pos" class="workspace" style="padding:10px;">
            <div class="pos-layout">
                <div class="pos-menu no-print">
                    <!-- Search & Filter -->
                    <div style="display:flex; gap:15px; margin-bottom:15px;">
                        <input type="text" class="input-std" placeholder="ğŸ” Ú¯Û•Ú•ÛŒØ§Ù†..." style="margin:0; font-size:1.1rem;" onkeyup="renderPOSMenu(this.value)">
                    </div>
                    
                    <!-- Category Tabs -->
                    <div id="category-tabs" class="category-bar"></div>

                    <!-- Products -->
                    <div id="pos-products" class="product-grid"></div>
                </div>
                
                <div class="pos-bill">
                    <div class="bill-header">
                        <img id="bill-header-logo" class="bill-logo-img" src="" alt="Logo">
                        <div id="print-custom-header">
                            <h2 id="bill-cafe-name" style="margin:0;">Black Bear Coffee</h2>
                            <p id="bill-cafe-info" style="margin:5px 0; font-size:0.9rem;">0750 000 00 00</p>
                        </div>
                        <h3 id="pos-active-table" style="margin-top:10px; background:#f3f4f6; display:inline-block; padding:5px 15px; border-radius:10px;">Table #</h3>
                        <br><small id="pos-date"></small>
                    </div>
                    <div class="bill-items" id="bill-rows"></div>
                    <div class="bill-footer">
                        <div class="bill-total-section" style="display:flex; justify-content:space-between; margin-bottom:15px; background:#f1f5f9; padding:15px; border-radius:12px;">
                            <span style="font-size:1.2rem; font-weight:bold;">Ú©Û†Ù… (CASH):</span>
                            <h2 id="bill-total" style="margin:0; color:var(--brand); font-size:1.8rem;">0</h2>
                        </div>
                        <p id="bill-footer-msg" style="text-align:center; font-size:0.8rem; margin-top:15px; display:none;">Ø³ÙˆÙ¾Ø§Ø³ Ø¨Û† Ø³Û•Ø±Ø¯Ø§Ù†Ø§ Ù‡Û•ÙˆÛ•</p>
                        
                        <div id="pos-actions-default">
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                                <button class="btn btn-warning" onclick="printKitchen()">
                                    <i class="fas fa-mug-hot"></i> Ú†Ø§ÛŒØ®Ø§Ù†Û•
                                </button>
                                <button class="btn btn-brand" onclick="processPayment()">
                                    <i class="fas fa-print"></i> ÙˆÛ•Ø±Ú¯Ø±ØªÙ†
                                </button>
                            </div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;" class="no-print">
                                <button class="btn btn-success" onclick="nav('tables')">ğŸ’¾ Ù¾Ø§Ø´Ú©Û•ÙØªÙ†</button>
                                <button class="btn btn-danger" onclick="cancelOrder()">ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
                            </div>
                        </div>

                        <!-- Reprint Actions -->
                        <div id="pos-actions-reprint" style="display:none;" class="no-print">
                             <button class="btn btn-brand" style="width:100%; justify-content:center; padding:15px;" onclick="window.print()">
                                <i class="fas fa-print"></i> Ù¾Ø±ÛŒÙ†Øª
                            </button>
                             <button class="btn btn-dark" style="width:100%; justify-content:center; padding:15px; margin-top:10px;" onclick="nav('reports')">
                                <i class="fas fa-arrow-left"></i> Ø²Ú¤Ú•ÛŒÙ† Ø¨Û† Ú•Ø§Ù¾Û†Ø±ØªØ§Ù†
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRODUCTS -->
        <div id="view-products" class="workspace">
            <h2><i class="fas fa-boxes"></i> Ø¨Û•Ú•ÛÙˆØ¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ Ø¦Ø§ÛŒØªÙ…Ø§Ù†</h2>
            <div class="card">
                <div style="display:grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto; gap:10px; align-items:end;">
                    <input type="hidden" id="p-id">
                    <div><label>Ù†Ø§Ú¤</label><input type="text" id="p-name" class="input-std"></div>
                    <div><label>Ø¨Ù‡Ø§</label><input type="number" id="p-price" class="input-std"></div>
                    <div><label>Ù¾Û†Ù„ÛÙ†</label><input type="text" id="p-cat" class="input-std" placeholder="Ù…ÛŒØ³Ø§Ù„: Cold Coffee"></div>
                    <div style="text-align:center;">
                        <label style="font-size:0.8rem;">Stock?</label><br>
                        <input type="checkbox" id="p-track" style="width:20px; height:20px; margin-top:10px;" onchange="toggleStockInput()">
                    </div>
                    <div><label>Ø¹Û•Ø¯Û•Øª</label><input type="number" id="p-qty" class="input-std" disabled></div>
                    <button id="btn-save-prod" class="btn btn-brand" style="height:46px; margin-bottom:10px;" onclick="saveProduct()"><i class="fas fa-save"></i></button>
                </div>
            </div>
            <div class="card"><table style="width:100%;"><thead><tr style="text-align:right;"><th>Ù†Ø§Ú¤</th><th>Ø¨Ù‡Ø§</th><th>Ù¾Û†Ù„ÛÙ†</th><th>Ø¹Û•Ø¯Û•Øª</th><th>Ú©Ø±Ø¯Ø§Ø±</th></tr></thead><tbody id="product-list"></tbody></table></div>
        </div>

        <!-- EXPENSES -->
        <div id="view-expenses" class="workspace">
            <h2><i class="fas fa-wallet"></i> Ø®Û•Ø±Ø¬ÛŒ</h2>
            <div class="card">
                <div style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap:10px;">
                    <input type="text" id="e-note" class="input-std" placeholder="ØªÛØ¨ÛŒÙ†ÛŒ">
                    <input type="number" id="e-amount" class="input-std" placeholder="Ø¨Ú•">
                    <button class="btn btn-danger" style="height:46px" onclick="saveExpense()">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</button>
                </div>
            </div>
            <div id="expense-list"></div>
        </div>

        <!-- REPORTS -->
        <div id="view-reports" class="workspace">
            <h2><i class="fas fa-file-invoice"></i> Ù…ÛÚ˜ÙˆÙˆ & Ø±Ø§Ù¾Û†Ø±Øª</h2>
            <div class="stat-grid">
                 <div class="card" style="grid-column: span 3;">
                    <h3>ğŸ“… ÙØ±Û†Ø´ØªÙ†Ø§ Ú•Û†Ú˜Ø§Ù†Û• (Daily Sales)</h3>
                    <div style="max-height: 250px; overflow-y:auto; margin-top:10px;">
                        <table class="report-table"><thead><tr><th>Ù…ÛÚ˜ÙˆÙˆ</th><th>Ú˜Ù…Ø§Ø±Ø§ Ù¾Ø³ÙˆÙˆÙ„Ø§Ù†</th><th>Ú©Û†Ù…Ø§ Ù¾Ø§Ø±Û•ÛŒ</th></tr></thead><tbody id="daily-sales-list"></tbody></table>
                    </div>
                 </div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div class="card">
                    <h3>ğŸ“œ Ù…ÛÚ˜ÙˆÙˆÛŒØ§ Ù¾Ø³ÙˆÙˆÙ„Ø§Ù† (ØªØ§Ú©)</h3>
                    <div style="margin-bottom:10px;"><input type="text" class="input-std" placeholder="Ú¯Û•Ú•ÛŒØ§Ù† Ù„ Ù…ÛÚ˜ÙˆÙˆÛŒÛ..." onkeyup="renderSalesHistory(this.value)"></div>
                    <div id="sales-history-list" style="max-height: 400px; overflow-y:auto;"></div>
                </div>
                <div class="card"><h3>ğŸ› ï¸ ØªÛ†Ù…Ø§Ø± (Logs)</h3><div id="log-list" style="max-height: 400px; overflow-y:auto; background:#f8fafc; padding:15px; border-radius:10px;"></div></div>
            </div>
        </div>

        <!-- SETTINGS -->
        <div id="view-settings" class="workspace">
            <h2><i class="fas fa-cog"></i> Ø±ÛÚ©Ø®Ø³ØªÙ†</h2>
            <div class="card" style="border-top: 5px solid var(--brand);">
                <h3><i class="fas fa-print"></i> Ø¯ÛŒØ²Ø§ÛŒÙ†Ø§ Ù¾Ø³ÙˆÙˆÙ„Û</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <!-- OFFLINE LOGO UPLOAD -->
                    <div style="grid-column: span 2;">
                        <label>ÙˆÛÙ†Û Ù„Û†Ú¯Û†ÛŒ (Upload Logo)</label>
                        <input type="file" id="set-cafe-logo-file" class="input-std" accept="image/*" onchange="handleLogoUpload(this)">
                        <img id="logo-preview" style="max-width:100px; display:none; margin-top:10px; border:1px solid #ddd; padding:5px;">
                    </div>
                    
                    <div><label>Ù†Ø§Ú¤Û Ú©Ø§ÙØªØ±ÛŒØ§</label><input type="text" id="set-cafe-name" class="input-std"></div>
                    <div><label>Ú˜Ù…Ø§Ø±Û• / Ù†Ø§Ú¤Ù†ÛŒØ´Ø§Ù†</label><input type="text" id="set-cafe-info" class="input-std"></div>
                    <div style="grid-column: span 2;"><label>Ù†Ú¤ÛŒØ³ÛŒÙ†Ø§ Ø®ÙˆØ§Ø±Û</label><input type="text" id="set-cafe-footer" class="input-std"></div>
                    <div style="grid-column: span 2;"><button class="btn btn-brand" onclick="savePrintSettings()">ğŸ’¾ Ù¾Ø§Ø´Ú©Û•ÙØªÙ†Ø§ Ø¯ÛŒØ²Ø§ÛŒÙ†Û</button></div>
                </div>
            </div>
            <div class="card"><h3>ğŸ’¾ Backup Data</h3><button class="btn btn-brand" onclick="exportDB()">Save Database (JSON)</button></div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let db = null;
        let fileHandle = null;
        let activeTableId = null;
        let currentUser = null; 
        let activeCategory = 'all';

        // --- AUTH SYSTEM ---
        const USERS = [
            { pin: '0000', name: 'Ø®Ø§ÙˆÛ•Ù†', role: 'admin' },
            { pin: '1234', name: 'Ú©Ø§Ø´ÛŒÛØ±', role: 'cashier' }
        ];

        function attemptLogin() {
            const pin = document.getElementById('pin-code').value;
            const user = USERS.find(u => u.pin === pin);
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('user-display').innerText = user.name + " (" + user.role + ")";
                const protectedItems = document.querySelectorAll('.protected');
                protectedItems.forEach(el => { el.style.display = user.role === 'admin' ? 'flex' : 'none'; });
                logAction("Login", `${user.name} logged in`);
                renderAll();
                applyPrintSettings();
            } else {
                document.getElementById('login-error').innerText = "Ù¾ÛŒÙ† Ú©Û†Ø¯ Ø®Û•Ù„Û•ØªÛ•!";
            }
        }

        // --- DATABASE ENGINE ---
        async function initDB(type) {
            try {
                if (type === 'new') {
                    fileHandle = await window.showSaveFilePicker({
                        suggestedName: 'BlackBear_POS_Data.json',
                        types: [{ description: 'JSON DB', accept: {'application/json': ['.json']} }]
                    });
                    db = { 
                        tables: [], products: [], sales: [], expenses: [], logs: [],
                        settings: { cafeName: "Black Bear Coffee", cafeInfo: "0750 XXX XX XX", footer: "Have a nice day!", logoData: "" } 
                    };
                    // DEFAULT COFFEE ITEMS
                    db.products.push(
                        {id: 1, name: 'Espresso', price: 2000, cat: 'Hot Coffee', trackStock: false, qty: 0},
                        {id: 2, name: 'Americano', price: 3000, cat: 'Hot Coffee', trackStock: false, qty: 0},
                        {id: 3, name: 'Spanish Latte', price: 4000, cat: 'Cold Coffee', trackStock: false, qty: 0},
                        {id: 4, name: 'V60', price: 4500, cat: 'Brew Bar', trackStock: false, qty: 0},
                        {id: 5, name: 'Cheesecake', price: 3500, cat: 'Sweets', trackStock: false, qty: 0}
                    );
                } else {
                    [fileHandle] = await window.showOpenFilePicker();
                    const file = await fileHandle.getFile();
                    db = JSON.parse(await file.text());
                    if(!db.settings) db.settings = { cafeName: "Black Bear Coffee", cafeInfo: "", footer: "Thanks", logoData: "" };
                    if(!db.logs) db.logs = [];
                }
                document.getElementById('startup-screen').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
                saveToDisk();
            } catch (err) {
                console.error(err);
                alert("Ù‡Û•Ù„Û•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§");
            }
        }

        async function saveToDisk() {
            if (!fileHandle) return;
            const writable = await fileHandle.createWritable();
            await writable.write(JSON.stringify(db, null, 2));
            await writable.close();
        }

        function logAction(action, detail) {
            if(!db) return;
            db.logs.unshift({ date: new Date(), action, detail, user: currentUser ? currentUser.name : 'System' });
            if(db.logs.length > 200) db.logs.pop(); 
            saveToDisk();
        }

        // --- NAVIGATION ---
        function nav(id) {
            document.querySelectorAll('.workspace').forEach(w => w.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).classList.add('active');
            const navBtn = document.querySelector(`.nav-item[onclick="nav('${id}')"]`);
            if(navBtn) navBtn.classList.add('active');
            
            if(id === 'settings') loadPrintSettingsInputs();
            if(id === 'reports') { renderSalesHistory(); renderDailySales(); renderLogs(); }
            renderAll();
        }

        function renderAll() {
            if(!db) return;
            renderDashboard();
            renderTables();
            renderProducts();
            renderExpenses();
            updateStats();
        }

        // --- SETTINGS ---
        function handleLogoUpload(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                db.settings.logoData = e.target.result; 
                document.getElementById('logo-preview').src = db.settings.logoData;
                document.getElementById('logo-preview').style.display = 'block';
                saveToDisk();
            };
            reader.readAsDataURL(file);
        }

        function loadPrintSettingsInputs() {
            if(db && db.settings) {
                document.getElementById('set-cafe-name').value = db.settings.cafeName;
                document.getElementById('set-cafe-info').value = db.settings.cafeInfo;
                document.getElementById('set-cafe-footer').value = db.settings.footer;
                if(db.settings.logoData) {
                    document.getElementById('logo-preview').src = db.settings.logoData;
                    document.getElementById('logo-preview').style.display = 'block';
                }
            }
        }
        function savePrintSettings() {
            db.settings.cafeName = document.getElementById('set-cafe-name').value;
            db.settings.cafeInfo = document.getElementById('set-cafe-info').value;
            db.settings.footer = document.getElementById('set-cafe-footer').value;
            saveToDisk(); applyPrintSettings(); alert("Ø¯ÛŒØ²Ø§ÛŒÙ† Ù‡Ø§ØªÛ• ØªÛ†Ù…Ø§Ø±Ú©Ø±Ù† âœ…");
        }
        function applyPrintSettings() {
            if(db && db.settings) {
                document.getElementById('bill-cafe-name').innerText = db.settings.cafeName;
                document.getElementById('bill-cafe-info').innerText = db.settings.cafeInfo;
                document.getElementById('bill-footer-msg').innerText = db.settings.footer;
                const img = document.getElementById('bill-header-logo');
                if(db.settings.logoData && db.settings.logoData !== "") {
                    img.src = db.settings.logoData; img.style.display = 'block';
                } else { img.src = ""; img.style.display = 'none'; }
            }
        }

        // --- DASHBOARD ---
        function updateStats() {
            const todayStr = new Date().toDateString();
            const todaySales = db.sales.filter(s => new Date(s.date).toDateString() === todayStr);
            const totalSale = todaySales.reduce((sum, s) => sum + s.total, 0);
            const totalExp = db.expenses.reduce((sum, e) => sum + e.amount, 0);
            document.getElementById('st-sales').innerText = totalSale.toLocaleString();
            document.getElementById('st-exp').innerText = totalExp.toLocaleString();
            document.getElementById('st-profit').innerText = (totalSale - totalExp).toLocaleString();
            document.getElementById('st-count').innerText = todaySales.length;
        }

        function renderDashboard() {
            const container = document.getElementById('dash-tables');
            container.innerHTML = '';
            db.tables.filter(t => t.items.length > 0).forEach(t => {
                container.innerHTML += `<div class="p-card" style="height:auto; border-left:5px solid var(--danger)" onclick="openTable(${t.id})">
                    <i class="fas fa-mug-hot" style="color:var(--brand); font-size:2rem; margin-bottom:10px;"></i>
                    <b>${t.name}</b>
                    <div style="color:var(--danger)">${t.items.length} Ø¨Ø§Ø¨Û•Øª</div>
                </div>`;
            });
        }

        // --- TABLES ---
        function renderTables() {
            const grid = document.getElementById('tables-grid');
            grid.innerHTML = '';
            db.tables.forEach(t => {
                const busy = t.items.length > 0;
                grid.innerHTML += `
                    <div class="p-card" style="height:auto; background:${busy?'#fff1f2':'white'}; border-color:${busy?'var(--danger)':'transparent'}" onclick="openTable(${t.id})">
                        <div style="position:absolute; top:5px; left:5px;">
                            ${currentUser.role === 'admin' ? `<i class="fas fa-edit" style="color:#94a3b8" onclick="event.stopPropagation(); editTable(${t.id})"></i>` : ''}
                        </div>
                        <i class="fas fa-${busy ? 'user-clock' : 'chair'}" style="font-size:2.5rem; margin-bottom:10px; color:${busy ? 'var(--danger)' : '#cbd5e1'}"></i>
                        <h3>${t.name}</h3>
                        <small style="color:${busy?'var(--danger)':'#64748b'}">${busy ? 'Ù…Ú˜ÙˆÙˆÙ„' : 'Ú¤Ø§Ù„Ø§'}</small>
                    </div>`;
            });
        }
        function addTable() { const n = prompt("Ù†Ø§Ú¤Û Ù…ÛØ²Û:"); if(n) { db.tables.push({id: Date.now(), name: n, items: []}); logAction('Add Table', n); saveToDisk(); renderAll(); } }
        function editTable(id) { const t = db.tables.find(x => x.id === id); const n = prompt("Ú¯ÙˆÙ‡Û†Ú•ÛŒÙ†:", t.name); if(n) { t.name = n; saveToDisk(); renderAll(); } }

        function transferTableUI() {
            const fromName = prompt("Ú˜ Ù…ÛØ²Ø§ (From):"); if (!fromName) return;
            const fromTable = db.tables.find(t => t.name == fromName);
            if (!fromTable || fromTable.items.length === 0) return alert("Ù…ÛØ² Ú¤Ø§Ù„Ø§ÛŒÛ•!");
            const toName = prompt("Ø¨Û† Ù…ÛØ²Ø§ (To):"); if (!toName) return;
            const toTable = db.tables.find(t => t.name == toName);
            if (!toTable) return alert("Ù…ÛØ² Ù†ÛŒÙ†Û•!");
            if (confirm("Ú¯ÙˆØ§Ø³ØªÙ†Û•ÙˆÛ•ØŸ")) {
                toTable.items = [...toTable.items, ...fromTable.items]; fromTable.items = [];
                logAction('Transfer', `Moved table ${fromTable.name} to ${toTable.name}`);
                saveToDisk(); renderAll();
            }
        }

        function printZReport() {
            if (!confirm("Z-Report?")) return;
            const todayStr = new Date().toDateString();
            const todaySales = db.sales.filter(s => new Date(s.date).toDateString() === todayStr);
            const totalRevenue = todaySales.reduce((sum, s) => sum + s.total, 0);
            const todayExpenses = db.expenses.filter(e => new Date(e.date).toDateString() === todayStr);
            const totalExpenses = todayExpenses.reduce((sum, e) => sum + e.amount, 0);
            const netCash = totalRevenue - totalExpenses;
            const printWindow = window.open('', '', 'width=400,height=600');
            printWindow.document.write(`<html><head><title>Z-Report</title><style>body{font-family:monospace;text-align:center;direction:rtl;} .row{display:flex;justify-content:space-between;}</style></head><body>
                    <h2>${db.settings.cafeName}</h2><h3>Z-Report</h3><p>${new Date().toLocaleString()}</p><hr>
                    <div class="row"><span>ÙØ±Û†Ø´ØªÙ†:</span><span>${totalRevenue.toLocaleString()}</span></div>
                    <div class="row"><span>Ø®Û•Ø±Ø¬ÛŒ:</span><span>-${totalExpenses.toLocaleString()}</span></div>
                    <hr><h2>ØµØ§ÙÛŒ: ${netCash.toLocaleString()}</h2></body></html>`);
            printWindow.document.close(); printWindow.focus(); printWindow.print(); printWindow.close();
            logAction('Z-Report', `Printed Daily Report`);
        }

        // --- POS ENGINE ---
        function openTable(id) {
            activeTableId = id;
            const t = db.tables.find(x => x.id === id);
            document.getElementById('pos-actions-default').style.display = 'block';
            document.getElementById('pos-actions-reprint').style.display = 'none';
            document.getElementById('pos-products').style.pointerEvents = 'auto';
            document.getElementById('pos-products').style.opacity = '1';
            document.getElementById('pos-active-table').innerText = t.name;
            document.getElementById('pos-date').innerText = new Date().toLocaleString('ku');
            document.getElementById('nav-pos').style.display = 'flex';
            nav('pos'); applyPrintSettings(); renderPOSCategories(); renderPOSMenu(); renderBill();
        }

        function renderPOSCategories() {
            const container = document.getElementById('category-tabs');
            container.innerHTML = `<button class="cat-btn ${activeCategory === 'all' ? 'active' : ''}" onclick="setCategory('all')">Ù‡Û•Ù…ÛŒ</button>`;
            const cats = [...new Set(db.products.map(p => p.cat))].filter(Boolean);
            cats.forEach(c => {
                container.innerHTML += `<button class="cat-btn ${activeCategory === c ? 'active' : ''}" onclick="setCategory('${c}')">${c}</button>`;
            });
        }

        function setCategory(cat) { activeCategory = cat; renderPOSCategories(); renderPOSMenu(); }

        function renderPOSMenu(q = '') {
            const container = document.getElementById('pos-products');
            container.innerHTML = '';
            db.products.filter(p => p.name.includes(q) && (activeCategory === 'all' || p.cat === activeCategory)).forEach(p => {
                const hasStock = !p.trackStock || p.qty > 0;
                container.innerHTML += `
                    <div class="p-card" onclick="${hasStock ? `addToBill(${p.id})` : ''}" style="opacity:${hasStock ? 1 : 0.5}">
                        ${p.trackStock ? `<div class="qty-badge">${p.qty}</div>` : ''}
                        <b>${p.name}</b>
                        <p>${p.price.toLocaleString()}</p>
                    </div>`;
            });
        }

        function addToBill(pid) {
            const prod = db.products.find(p => p.id === pid);
            const table = db.tables.find(t => t.id === activeTableId);
            if(prod.trackStock && prod.qty <= 0) return alert("No Stock");
            if(prod.trackStock) prod.qty--;
            table.items.push({...prod, billId: Date.now()});
            saveToDisk(); renderBill(); renderPOSMenu(); 
        }

        function renderBill() {
            const table = db.tables.find(t => t.id === activeTableId);
            const container = document.getElementById('bill-rows');
            container.innerHTML = '';
            let total = 0;
            table.items.forEach((item, idx) => {
                total += item.price;
                container.innerHTML += `
                    <div class="bill-row">
                        <div style="display:flex; flex-direction:column; text-align:right;">
                            <span style="font-weight:bold;">${item.name}</span>
                            <small style="color:#64748b">${item.price.toLocaleString()}</small>
                        </div>
                        <div class="delete-btn no-print" onclick="removeFromBill(${idx})"><i class="fas fa-times"></i></div>
                    </div>`;
            });
            document.getElementById('bill-total').innerText = total.toLocaleString();
        }

        function removeFromBill(idx) {
            const table = db.tables.find(t => t.id === activeTableId);
            const item = table.items[idx];
            const prod = db.products.find(p => p.id === item.id);
            if(prod && prod.trackStock) prod.qty++;
            table.items.splice(idx, 1);
            saveToDisk(); renderBill(); renderPOSMenu();
        }

        function cancelOrder() {
            const table = db.tables.find(t => t.id === activeTableId);
            if(table.items.length === 0) return;
            if(confirm("Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÛŒ Ø¯Ø§Ø®ÙˆØ§Ø²ÛŒÛØŸ")) {
                table.items.forEach(item => { const prod = db.products.find(p => p.id === item.id); if(prod && prod.trackStock) prod.qty++; });
                table.items = []; saveToDisk(); nav('tables');
            }
        }

        function printKitchen() {
            if (db.tables.find(t => t.id === activeTableId).items.length === 0) return;
            document.body.classList.add('kitchen-mode');
            window.print();
            setTimeout(() => document.body.classList.remove('kitchen-mode'), 500);
        }

        function processPayment() {
            const table = db.tables.find(t => t.id === activeTableId);
            if (table.items.length === 0) return;
            const total = table.items.reduce((a,b) => a+b.price, 0);
            db.sales.push({ id: Date.now(), table: table.name, items: [...table.items], total: total, date: new Date(), cashier: currentUser.name });
            logAction('Sale', `Paid ${total} on ${table.name}`);
            window.print();
            table.items = [];
            saveToDisk(); setTimeout(() => nav('dash'), 1000);
        }

        // --- REPRINT & DELETE SALE FEATURE ---
        function reprintSale(saleId) {
            const sale = db.sales.find(s => s.id === saleId);
            if(!sale) return;
            document.getElementById('pos-active-table').innerText = sale.table + " (Copy)";
            document.getElementById('pos-date').innerText = new Date(sale.date).toLocaleString('ku');
            document.getElementById('nav-pos').style.display = 'flex';
            const container = document.getElementById('bill-rows'); container.innerHTML = '';
            sale.items.forEach(item => { container.innerHTML += `<div class="bill-row"><span>${item.name}</span><span>${item.price.toLocaleString()}</span></div>`; });
            document.getElementById('bill-total').innerText = sale.total.toLocaleString();
            document.getElementById('pos-actions-default').style.display = 'none';
            document.getElementById('pos-actions-reprint').style.display = 'block';
            document.getElementById('pos-products').style.pointerEvents = 'none';
            document.getElementById('pos-products').style.opacity = '0.5';
            nav('pos');
        }

        function deleteSale(saleId) {
            if(!confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒ Ú˜ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒÛØŸ Ø¦Û•Ù… Ú©Ø±Ø¯Ø§Ø±Û• Ù†Ø§ Ú¤Û•Ú¯Û•Ú•ÛØª!")) return;
            db.sales = db.sales.filter(s => s.id !== saleId);
            logAction('Delete', `Deleted Sale ID: ${saleId}`);
            saveToDisk();
            renderSalesHistory();
            renderDailySales();
            updateStats();
        }

        // --- REPORTING ---
        function renderDailySales() {
            const container = document.getElementById('daily-sales-list'); container.innerHTML = '';
            const grouped = {};
            db.sales.forEach(s => {
                const dateKey = new Date(s.date).toLocaleDateString('ku');
                if(!grouped[dateKey]) grouped[dateKey] = { count: 0, total: 0 };
                grouped[dateKey].count++; grouped[dateKey].total += s.total;
            });
            Object.keys(grouped).reverse().forEach(date => {
                container.innerHTML += `<tr><td>${date}</td><td>${grouped[date].count}</td><td style="color:var(--brand); font-weight:bold;">${grouped[date].total.toLocaleString()}</td></tr>`;
            });
        }

        function renderSalesHistory(q = '') {
            const list = db.sales.slice().reverse().filter(s => s.table.includes(q) || s.id.toString().includes(q));
            document.getElementById('sales-history-list').innerHTML = list.map(s => `
                <div style="border-bottom:1px solid #ddd; padding:10px; display:flex; justify-content:space-between; align-items:center;">
                    <div><b>${s.table}</b> <small>${new Date(s.date).toLocaleTimeString()}</small><br>${s.total.toLocaleString()} IQD</div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-brand" style="padding:5px 10px;" onclick="reprintSale(${s.id})"><i class="fas fa-print"></i></button>
                        <button class="btn btn-danger" style="padding:5px 10px;" onclick="deleteSale(${s.id})"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`).join('');
        }

        function renderLogs() { document.getElementById('log-list').innerHTML = db.logs.map(l => `<div style="border-bottom:1px solid #eee; font-size:0.8rem;">${l.action} - ${l.detail}</div>`).join(''); }

        // --- PRODUCTS CRUD ---
        function saveProduct() {
            const id = document.getElementById('p-id').value, name = document.getElementById('p-name').value;
            const price = parseInt(document.getElementById('p-price').value), cat = document.getElementById('p-cat').value;
            const track = document.getElementById('p-track').checked, qty = track ? parseInt(document.getElementById('p-qty').value) : 0;
            if (!name) return;
            if(id) { const p = db.products.find(x => x.id == id); Object.assign(p, {name, price, cat, trackStock: track, qty}); }
            else { db.products.push({ id: Date.now(), name, price, cat, trackStock: track, qty }); }
            document.getElementById('p-id').value = ''; document.getElementById('p-name').value = '';
            saveToDisk(); renderProducts();
        }
        function toggleStockInput() { document.getElementById('p-qty').disabled = !document.getElementById('p-track').checked; }
        function renderProducts() {
            document.getElementById('product-list').innerHTML = db.products.map(p => `
                <tr style="border-bottom:1px solid #f1f5f9;"><td>${p.name}</td><td>${p.price}</td><td>${p.cat}</td><td>${p.trackStock?p.qty:'âˆ'}</td>
                <td><button class="btn btn-danger" onclick="deleteProd(${p.id})"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function deleteProd(id) { if(confirm('Delete?')) { db.products = db.products.filter(p => p.id !== id); saveToDisk(); renderProducts(); }}

        function saveExpense() {
            const note = document.getElementById('e-note').value, amount = parseInt(document.getElementById('e-amount').value);
            if (note && amount) { db.expenses.push({ id: Date.now(), note, amount, date: new Date(), user: currentUser.name }); saveToDisk(); renderExpenses(); }
        }
        function renderExpenses() { document.getElementById('expense-list').innerHTML = db.expenses.map(e => `<div class="card" style="padding:10px;"><b>${e.note}</b> <span style="float:left;color:red">${e.amount}</span></div>`).join(''); }
        function exportDB() { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(db)], {type:'application/json'})); a.download='BlackBear_Backup.json'; a.click(); }
    </script>
</body>
</html>
